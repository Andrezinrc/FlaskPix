{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <div class="container">
    
    <div class="boas-vindas-dash">
        <h2>Bem-vindo, {{ username }}!</h2>
        <h3><i class="fas fa-wallet"></i> Saldo Atual: R$ {% if balance is not none %}{{ balance }}{% else %}0{% endif %}</h3>
    </div>
    <h3><i class="fas fa-credit-card"></i> Gerar Pix</h3>
    <input type="number" id="valor_pix" placeholder="Digite o valor">
    <button onclick="gerarPix()">Gerar Pix</button>

    <h3>Histórico de Pagamentos</h3>
    <ul class="historico-pagamentos" style="color: #ff7f00; text-decoration: underline;">
    {% for payment in payments %}
        <li><i class="fas fa-check-circle"></i> R$ {{ payment.amount }} - Código Pix: {{ payment.pix_code }}</li>
    {% endfor %}
    </ul>
    </div>
    <script>
        function gerarPix() {
            let valor = document.getElementById("valor_pix").value;

            fetch("{{ url_for('gerar_pix') }}", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ amount: valor })
            })
            .then(response => response.json())
            .then(data => alert(data.message + " Código: " + data.pix_code))
            .catch(error => alert("Erro ao gerar Pix!"));
        }
    </script>
{% endblock %}
